---
import "../../styles/global.scss";
import styles from '../blog.module.scss';
import Layout from '../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import GridPost from '../../components/GridPost/GridPost.astro';

export const prerender = true;

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  const categories = [...new Set(allPosts.map(post => post.data.category).filter(Boolean))];
  
  return categories.map(category => ({
    params: { category: category!.toLowerCase().replace(/\s+/g, '-') },
    props: { categoryName: category }
  }));
}

const { category } = Astro.params;
const { categoryName } = Astro.props;

const allPosts = await getCollection('blog');
const posts = allPosts.filter(post => 
  post.data.category?.toLowerCase().replace(/\s+/g, '-') === category
).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Navigation categories
const navCategories = [
  { slug: 'direito-civil', name: 'Direito Civil' },
  { slug: 'direito-trabalhista', name: 'Direito Trabalhista' },
  { slug: 'criminal', name: 'Criminal' }
];
---
<Layout>
  <main class={styles.section_blog}>
    <div class={styles.section_blog__container}>
      <div class={styles.section_blog__header}>
        <span class={styles.section_blog__subtitle}>Categoria</span>
        <h1 class={styles.section_blog__title}>{categoryName || category}</h1>
      </div>
      <nav>
        <ul class={styles.section_blog__nav}>
          <li class={styles.section_blog__navItem}><a href="/blog">Todas as categorias</a></li>
          {navCategories.map(cat => (
            <li class={`${styles.section_blog__navItem} ${category === cat.slug ? 'active' : ''}`}>
              <a href={`/category_slug/${cat.slug}`}>{cat.name}</a>
            </li>
          ))}
        </ul>
      </nav>
      <GridPost posts={posts} />
    </div>
  </main>
</Layout>

<style>
  .active {
    font-weight: bold;
  }
</style>
